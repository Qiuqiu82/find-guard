# 关卡编辑器功能文档

## 📋 项目概述

**项目名称**: 图片警示点游戏关卡编辑器  
**版本**: v2.0  
**技术栈**: Vue 3 + TypeScript + Element Plus  
**项目类型**: 前端管理系统组件  

## 🎯 核心功能

### 1. 游戏设置模块
- **关卡配置**: 设置游戏总关卡数量（1-图片总数）
- **时间设置**: 
  - 倒计时设置：10-120秒，步长5秒
  - 闪烁提醒：5-30秒，步长5秒
- **数据持久化**: 自动保存到localStorage

### 2. 图片绘制模块
- **图片管理**: 
  - 支持JPG/PNG/WebP格式
  - 建议尺寸：1920×945
  - 文件大小限制：5MB
  - 拖拽上传支持
- **警示点绘制**: 
  - 全屏绘制模式
  - 鼠标拖拽绘制矩形区域
  - 最小绘制尺寸：10×10像素
  - 实时预览绘制效果
- **警示点编辑**: 
  - 标题设置（最大50字符）
  - 详细说明（最大200字符）
  - 连接线类型：横线/先竖后横
- **连接线预览**: 实时显示连接线效果

### 3. 数据管理模块
- **数据导出**: JSON格式，包含所有关卡和警示点信息
- **数据导入**: 支持JSON文件导入，覆盖现有数据
- **数据验证**: 导入时自动验证数据结构完整性

## 🏗️ 技术架构

### 前端技术栈
```
Vue 3.0+ (Composition API)
TypeScript 4.0+
Element Plus UI组件库
CSS3 + Flexbox/Grid布局
```

### 核心依赖
```json
{
  "vue": "^3.0.0",
  "element-plus": "^2.0.0",
  "@element-plus/icons-vue": "^2.0.0"
}
```

### 浏览器兼容性
- Chrome 80+
- Firefox 75+
- Safari 13+
- Edge 80+

## 📊 数据结构

### 1. 警示点数据结构 (PuzzlePoint)
```typescript
interface PuzzlePoint {
  x: number;                    // X坐标（相对坐标，0-1）
  y: number;                    // Y坐标（相对坐标，0-1）
  width: number;                // 宽度（相对尺寸，0-1）
  height: number;               // 高度（相对尺寸，0-1）
  found: boolean;               // 是否已被找到
  highlightTitle: string;       // 警示标题
  highlightDetail: string;      // 详细说明
  connectionType?: 'horizontal' | 'vertical-horizontal'; // 连接线类型
}
```

### 2. 关卡数据结构 (GameLevel)
```typescript
interface GameLevel {
  image: string;                // 图片base64或URL
  points: PuzzlePoint[];        // 警示点数组
}
```

### 3. 游戏设置结构 (GameSettings)
```typescript
interface GameSettings {
  totalLevels: number;          // 总关卡数
  countdownSeconds: number;     // 倒计时秒数
  flashThreshold: number;       // 闪烁提醒阈值
}
```

## 🔧 核心算法

### 1. 坐标缩放计算
```typescript
// 计算图片显示尺寸与原始尺寸的缩放比例
const scaleX = displayWidth / naturalWidth;
const scaleY = displayHeight / naturalHeight;

// 将鼠标坐标转换为相对坐标
const relativeX = (mouseX - rect.left) / scaleX;
const relativeY = (mouseY - rect.top) / scaleY;
```

### 2. 绘制区域计算
```typescript
// 计算绘制矩形的实际位置和尺寸
const x = Math.min(startPoint.x, currentPoint.x);
const y = Math.min(startPoint.y, currentPoint.y);
const width = Math.abs(currentPoint.x - startPoint.x);
const height = Math.abs(currentPoint.y - startPoint.y);
```

### 3. 连接线渲染算法
```typescript
// 横线连接线
const horizontalLine = {
  width: 150px,
  height: 4px,
  position: 'right: -150px, top: 50%'
};

// 垂直-水平连接线
const verticalLine = {
  width: 4px,
  height: 120px,
  position: 'left: 50%, top: -120px'
};
```

## 🎨 UI/UX设计

### 1. 设计理念
- 参考Soybean管理系统设计风格
- 现代化卡片式布局
- 渐变色彩方案
- 响应式设计

### 2. 色彩规范
```css
主色调: #1e1c72 (深蓝)
辅助色: #2d2a9d (中蓝)
背景色: #f8f9fa (浅灰)
边框色: #e9ecef (中灰)
成功色: #28a745 (绿色)
警告色: #ffc107 (黄色)
危险色: #dc3545 (红色)
```

### 3. 动画效果
- 卡片悬停：上浮2px + 阴影增强
- 按钮悬停：上浮1px + 阴影效果
- 绘制动画：缩放+透明度过渡
- 所有过渡：0.3s ease

## 📱 响应式设计

### 断点设置
```css
/* 桌面端 */
@media (min-width: 1200px) { /* 完整三栏布局 */ }

/* 平板端 */
@media (max-width: 1199px) { /* 边栏收缩，绘制区域垂直布局 */ }

/* 移动端 */
@media (max-width: 767px) { /* 垂直堆叠布局 */ }
```

### 布局适配
- **桌面端**: 左侧边栏(350px) + 主内容区
- **平板端**: 左侧边栏(280px) + 主内容区
- **移动端**: 上下堆叠，边栏在上方(40vh高度)

## 🔐 数据安全

### 1. 文件上传安全
- 文件类型验证：仅允许图片格式
- 文件大小限制：最大5MB
- 图片尺寸建议：1920×945

### 2. 数据验证
- 导入数据格式验证
- 数据结构完整性检查
- 坐标范围验证（0-1）

### 3. 本地存储
- 使用localStorage存储设置
- 敏感数据不存储
- 定期清理过期数据

## 🚀 性能优化

### 1. 图片处理
- 图片懒加载
- 缩略图预览
- 压缩上传

### 2. 渲染优化
- 虚拟滚动（大量图片时）
- 防抖绘制操作
- 事件委托

### 3. 内存管理
- 及时清理事件监听器
- 释放图片资源
- 避免内存泄漏

## 🐛 已知问题与解决方案

### 1. 全屏绘制模式
**问题**: 在某些浏览器中全屏模式可能不稳定  
**解决方案**: 使用fixed定位 + 100vw/100vh，添加浏览器前缀

### 2. 触摸设备支持
**问题**: 移动设备触摸绘制精度较低  
**解决方案**: 增加触摸事件支持，优化触摸精度

### 3. 大图片性能
**问题**: 大尺寸图片可能导致卡顿  
**解决方案**: 图片压缩，分块渲染

## 📋 API接口

### 1. 组件Props
```typescript
interface Props {
  allGameLevels: GameLevel[];    // 所有关卡数据
  totalLevels: number;           // 当前关卡数量
}
```

### 2. 组件事件
```typescript
interface Emits {
  (e: 'close'): void;                           // 关闭编辑器
  (e: 'update:totalLevels', value: number): void; // 更新关卡数量
  (e: 'update:allGameLevels', value: GameLevel[]): void; // 更新关卡数据
}
```

## 🔄 数据流

### 1. 数据更新流程
```
用户操作 → 组件状态更新 → 触发emit事件 → 父组件接收 → 更新全局状态 → 重新渲染
```

### 2. 数据持久化流程
```
设置变更 → localStorage存储 → 页面刷新 → 自动加载 → 恢复设置
```

### 3. 图片上传流程
```
选择文件 → 格式验证 → 大小检查 → 读取文件 → 创建Image对象 → 获取尺寸 → 创建关卡 → 更新状态
```

## 🧪 测试建议

### 1. 功能测试
- 图片上传功能
- 警示点绘制功能
- 设置保存功能
- 数据导入导出功能

### 2. 兼容性测试
- 不同浏览器测试
- 不同屏幕尺寸测试
- 触摸设备测试

### 3. 性能测试
- 大量图片加载测试
- 绘制操作性能测试
- 内存使用测试

## 📚 开发指南

### 1. 环境搭建
```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 构建生产版本
npm run build
```

### 2. 代码规范
- 使用TypeScript严格模式
- 遵循Vue 3 Composition API规范
- 使用ESLint + Prettier代码格式化

### 3. 组件开发
- 单一职责原则
- Props类型定义
- 事件命名规范
- 样式作用域隔离

## 🔮 未来规划

### 1. 功能增强
- 批量操作支持
- 撤销/重做功能
- 模板系统
- 协作编辑

### 2. 技术升级
- Vue 3.4+新特性
- 性能监控集成
- 自动化测试
- CI/CD流程

### 3. 用户体验
- 快捷键支持
- 主题切换
- 多语言支持
- 无障碍访问

## 📞 技术支持

### 1. 开发环境
- Node.js 16+
- npm 8+
- Vue CLI 5+

### 2. 调试工具
- Vue DevTools
- 浏览器开发者工具
- 性能分析工具

### 3. 常见问题
- 查看浏览器控制台错误信息
- 检查网络请求状态
- 验证数据格式正确性

---

**文档版本**: v1.0  
**最后更新**: 2024年8月28日  
**维护人员**: AI Assistant  
**审核状态**: 待审核 