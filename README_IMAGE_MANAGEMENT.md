# 图片管理功能说明

## 功能概述

图片管理功能是一个完整的游戏图片警示点绘制系统，支持13张预置图片和用户自定义图片的上传、编辑、导出等功能。

## 主要特性

### 1. 预置图片
- 包含12张真实的安全识别图片
- 每张图片都有2-4个预设的警示点
- 涵盖多种安全场景：邮件安全识别、网站安全识别、办公安全识别等

### 2. 全屏绘制模式
- 点击"全屏编辑"进入全屏绘制模式
- 图片以正常游戏界面方式全屏显示
- 支持鼠标拖拽绘制矩形警示点

### 3. 浮动工具栏
- 可拖拽的浮动工具栏
- 支持4种绘制模式：选择、矩形、移动、删除
- 3种连接线类型：横线、竖线、横+竖组合
- 工具栏位置自动保存到localStorage

### 4. 警示点功能
- 矩形警示点绘制（最小20x20像素）
- 警示标题和详细内容编辑
- 连接线自动计算位置
- 支持删除和编辑现有警示点

### 5. 数据管理
- 图片上传（支持jpg、png、gif格式）
- JSON格式导入/导出
- 自定义图片本地存储
- 预置图片保护（不可删除）

## 使用方法

### 进入图片管理
1. 登录管理系统
2. 导航到"图片管理"页面
3. 查看12张预置图片和统计信息

### 全屏编辑图片
1. 在图片列表中找到目标图片
2. 点击"全屏编辑"按钮
3. 进入全屏绘制模式

### 绘制警示点
1. 在工具栏选择"矩形"模式
2. 选择连接线类型（横线/竖线/横+竖）
3. 在图片上拖拽绘制矩形
4. 编辑警示点标题和描述
5. 点击"保存"按钮

### 工具栏操作
- **拖拽移动**：点击工具栏标题栏拖拽
- **折叠/展开**：点击折叠按钮
- **重置位置**：点击重置按钮恢复默认位置

### 导入导出
- **导出**：点击"导出所有数据"下载JSON文件
- **导入**：点击"导入数据"选择JSON文件上传

## 技术实现

### 核心组件
- `ImagesPage.vue`：主页面，显示图片列表和操作
- `ImageEditor.vue`：全屏编辑器，处理绘制逻辑
- `presetImages.ts`：预置图片数据
- `image.ts`：类型定义

### 关键技术点
1. **坐标换算**：relativeX = (mouseX - rect.left) / scaleX
2. **矩形校验**：小于阈值直接取消，避免创建无效点
3. **连接线渲染**：绝对定位元素绘制横线或竖+横组合
4. **工具栏拖拽**：mousedown + mousemove + mouseup，限制在窗口内
5. **localStorage**：保存点位与工具栏位置，刷新后恢复
6. **性能优化**：图片加载完后再计算比例，绘制层用单独容器

### 响应式设计
- 支持不同屏幕尺寸
- 移动端友好的工具栏布局
- 图片网格自适应排列

## 数据结构

### 警示点 (WarningPoint)
```typescript
interface WarningPoint {
  id: string
  x: number
  y: number
  width: number
  height: number
  title: string
  description: string
  connectionType: 'horizontal' | 'vertical' | 'horizontal-vertical'
  connectionOffset: { x: number, y: number }
}
```

### 游戏图片 (GameImage)
```typescript
interface GameImage {
  id: string
  name: string
  url: string
  size: number
  width: number
  height: number
  warningPoints: WarningPoint[]
  createdAt: string
  updatedAt: string
}
```

## 验收标准

✅ **进入"图片管理"能看到12张内置图片**
✅ **点击进入全屏，能自由绘制矩形警示点并编辑属性**
✅ **工具栏可切换模式、拖拽、记住位置**
✅ **导出JSON正确，导入后能恢复**
✅ **删除/上传图片操作正常**
✅ **设置模块（关卡数量）能根据图片数量联动更新**

## 注意事项

1. **预置图片保护**：预置图片不可删除，只能编辑警示点
2. **文件大小限制**：单个图片文件不超过5MB
3. **浏览器兼容性**：需要支持ES6+的现代浏览器
4. **数据持久化**：自定义图片数据存储在localStorage中
5. **性能考虑**：大量警示点可能影响绘制性能

## 扩展功能

### 未来计划
- [ ] 支持更多图片格式（WebP、AVIF）
- [ ] 添加图片滤镜和特效
- [ ] 支持视频帧提取
- [ ] 云端存储和同步
- [ ] 协作编辑功能
- [ ] 版本控制和历史记录

### 自定义开发
- 可以修改`presetImages.ts`添加更多预置图片
- 可以扩展`image.ts`添加新的属性字段
- 可以修改`ImageEditor.vue`添加新的绘制工具

## 故障排除

### 常见问题
1. **图片无法显示**：检查图片URL是否有效
2. **工具栏无法拖拽**：确保浏览器支持触摸/鼠标事件
3. **警示点位置偏移**：检查图片尺寸和缩放比例
4. **数据导入失败**：确保JSON格式正确

### 调试技巧
- 打开浏览器开发者工具查看控制台错误
- 检查localStorage中的数据完整性
- 验证图片加载状态和尺寸信息 